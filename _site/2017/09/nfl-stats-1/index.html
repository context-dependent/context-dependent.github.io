<!DOCTYPE html>
<html>
    <!DOCTYPE html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="apple-touch-icon" sizes="76x76" href="/assets/images/logo.png">
    <link rel="icon" type="image/png" href="/assets/images/logo.png">

    <title>NFL stats 1</title>

    <meta name="keywords" content="WngLMng, wangliming, 王立明">
    <meta name="author" content="WngLMng">
    <meta name="description" content="嗨，我是王立明，一名来自黑龙江省鹤岗市的男生。<br/>现于无线生活（北京），从事互联网开发工作。">

    <meta property="og:site_name" content="WngLMng's Blog — 一个写代码的">
    <meta property="og:url" content="/">
    <meta property="og:title" content="NFL stats 1">
    <meta property="og:type" content="article">
    <meta property="og:description" content="This series will use historical data from NFL seasons between 1992 and 2016 to illustrate some data munging, analysis, and visualization techniques in R. Ame...">

    <!--   Core CSS Files   -->
    <link href="//cdn.bootcss.com/flex-layout-attribute/1.0.3/css/flex-layout-attribute.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css">

    <!-- Canonical SEO -->
    <link rel="canonical" href="https://wnglmng.com/2017/09/nfl-stats-1/">
    <link rel="alternate" type="application/rss+xml" title="WngLMng's Blog" href="https://wnglmng.com/feed.xml">
</head>

<body>
    <div id="nav" layout="row top-left">
    <div self="left">
        <a href="/"><div class="logo logo-isNotVisIfMobile">WngLMng's Blog</div></a>
        <a href="/"><div class="logo logo-isVisIfMobile"></div></a>
    </div>
    <div class="nav-isNotVisIfMobile">
        <div class="item">
            <a href="/tags">Tags</a>
        </div>
        <div class="item">
            <a href="/videos">Videos</a>
        </div>
    </div>
    <div class="nav-isVisIfMobile">
        <div class="item">
            <a href="/tags">Tags</a>
        </div>
        <div class="item">
            <a href="/videos">Videos</a>
        </div>
    </div>
</div>

    <div id="content">
        <div class="container container--header">
    <h1 class="h1--home-title">NFL stats 1</h1>
    <p>Scraping and cleaning data from Pro-Football-Reference.com</p>
</div>

        <link rel="stylesheet" type="text/css" href="/assets/css/article.css">

<div class="page-wrapper">
    <div class="container--text">
        <p>This series will use historical data from NFL seasons between 1992 and 2016 to illustrate some data munging, analysis, and visualization techniques in R. American football is particularly suited to analysis because of its stop / reset / start structure, the singular focus of every play (one pass, one run, one kick etc.), and the strictly defined, narrow roles played by each man on the field.</p>

<p>Pro-Football-Reference has a wealth of freely available detailed historical data. We are going to use <code>rvest</code> and <code>dplyr</code>, part of the <code>tidyverse</code>, to scrape, clean, and concatenate that historical data.</p>

<h2>Scraping functions</h2>

<h3>Get one table from PFR</h3>
<figure class="highlight"><pre><code class="language-r" data-lang="r">pfr_single &lt;- function(yr) {
  url &lt;- sprintf(&quot;https://www.pro-football-reference.com/years/%d/fantasy.htm&quot;,
                 yr)

  cols &lt;- c(&quot;rank&quot;, &quot;name&quot;, &quot;team&quot;, &quot;pos&quot;, &quot;age&quot;, &quot;played&quot;, &quot;started&quot;,
            &quot;pass_cmp&quot;, &quot;pass_att&quot;, &quot;pass_yds&quot;, &quot;pass_td&quot;, &quot;pass_int&quot;,
            &quot;rush_att&quot;, &quot;rush_yds&quot;, &quot;rush_ypc&quot;, &quot;rush_td&quot;,
            &quot;rec_tgt&quot;, &quot;rec_rec&quot;, &quot;rec_yds&quot;, &quot;rec_ypr&quot;, &quot;rec_td&quot;,
            &quot;f_points&quot;, &quot;dkpt&quot;, &quot;fdpt&quot;, &quot;vbd&quot;, &quot;pos_rank&quot;, &quot;ov_rank&quot;)
  print(url)
  tbl_raw &lt;- (read_html(url) %&gt;%
                html_table(header = FALSE))[[1]]

  colnames(tbl_raw) &lt;- cols

  tbl_clean &lt;- tbl_raw %&gt;%
    mutate(year = yr, rank = as.integer(rank)) %&gt;%
    filter(complete.cases(.))

  return(tbl_clean)
}
</code></pre></figure>
<h3>Apply pfr_single to a to a range of years</h3>
<figure class="highlight"><pre><code class="language-r" data-lang="r">#&#39; Scrape and clean data from profootballreference.com for a range of years.
#&#39; returns a single tibble with a position, passing, rushing, receiving
#&#39; statistics for each player, along with age etc.
#&#39;
#&#39; @param yrs vector -- integers between 1993 and 2016
#&#39; @param write logical -- whether or not to write the cleaned data to a csv in
#&#39; the ./Data folder
#&#39;
#&#39; @return df_bound a tibble
#&#39; @export fantasy_data_YRSTART_YREND.csv
#&#39;
#&#39; @examples
#&#39;
scrape_fantasy &lt;- function(yrs, write = TRUE) {
  suppressWarnings(
    df_bound &lt;- lapply(yrs, pfr_single) %&gt;% bind_rows %&gt;%
      as_data_frame() %&gt;%
      mutate_at(
        .vars = vars(-name, -team, -pos),
        .funs = as.numeric
      ) %&gt;%
      filter(pos != &quot;&quot;, !is.na(f_points))
  )

  if(write) {
    write_csv(df_bound,
      sprintf(&quot;./Data/fantasy_data_%d_%d.csv&quot;, min(yrs), max(yrs)))
  }
  return(df_bound)
}
</code></pre></figure>
<h2>Example plots</h2>

<h3>Season point distributions by position</h3>
<figure class="highlight"><pre><code class="language-r" data-lang="r">df_stats %&gt;%
  filter(f_points &gt; 0) %&gt;%
  ggplot(aes(f_points, fill = pos)) +
  geom_histogram(binwidth = 1) +
  ggthemes::scale_fill_wsj() +
  facet_grid(pos~.)
</code></pre></figure>
<p><img src="https://wnglmng.com/assets/images/pos_points.png" alt="season points by position plot"></p>

    </div>
</div>

<style type="text/css">
    .ds-thread {
        max-width: 680px;
        margin: auto;
    }
</style>

<!-- 多说评论框 start -->
<!-- <div class="ds-thread" data-thread-key="/2017/09/nfl-stats-1/" data-title=NFL stats 1 data-url=https://wnglmng.com/2017/09/nfl-stats-1/></div> -->
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
// var duoshuoQuery = {short_name:"wnglmng"};
//     (function() {
//         var ds = document.createElement('script');
//         ds.type = 'text/javascript';ds.async = true;
//         ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
//         ds.charset = 'UTF-8';
//         (document.getElementsByTagName('head')[0]
//          || document.getElementsByTagName('body')[0]).appendChild(ds);
//     })();
</script>
<!-- 多说公共JS代码 end -->

<div class="related_posts-container" style="max-width: 790px;">
    <p class="related_posts-header">RELATED ARTICLES</p>

    <div layout="rows center-spread">

        
        
        
        
            <a href="/2017/03/spring-boot-Introduction/">
                <div class="card card--article not-visible" >
                    <div class="card-body">
                        <div class="card-title">Spring Boot 参考指南之入门指南</div>
                        <div class="card-description card-description--clamp-0">
                            Spring Boot 介绍这个段落提供 Spring Boot 参考指南的简要综述。将它视作其他部分介绍的指引。你可以顺次阅读本参考指南，或者跳过你不感兴趣的部分。1.关于资料Spring Boot 参考指南现提供 html，pdf 以及 epub 版本，最新版可以访问 http://docs.spring.io/spring-boot/docs/current/reference。这些资...
                        </div>
                    </div>
                    <div class="card-hero">
                        <div class="card-image card-image--size-185" data-url="https://ww1.sinaimg.cn/mw690/906cb9dbly1fdoq1o4qe1j20q00d4qed"></div>
                    </div>
                    <div class="card-footer">
                        <div class="card-footer-wrapper" layout="row bottom-left">
                            <div class="card-type is-notShownIfHover">2017-03-15</div>
                            <div class="card-tag is-notShownIfHover">@WngLMng</div>
                            <div class="card-tag is-shownIfHover">
                                
                                    code &nbsp;&nbsp;
                                
                            </div>
                            <div class="card-logo is-shownIfHover" self="right"></div>
                        </div>
                    </div>
                 </div>
            </a>
        
        

        

    </div>
</div>


    </div>
    <div id="footer" layout="rows center-left">
    <div id="end-mark">
        <div class="end-mark-icon"></div>
        <p class="copyright">WngLMng' Blog © 2015&nbsp;&nbsp;·&nbsp;&nbsp;一个写代码的</p>
    </div>
    <div id="footer-links" self="right">
        <ul>
            <a href="#"><li class="wechat" target="_blank"></li></a>
            <a href="mailto:wnglmng@gmail.com" target="_blank"><li class="mail"></li></a>
            <a href="http://weibo.com/sunmoon1993" target="_blank"><li class="weibo"></li></a>
            <a href="https://github.com/wnglmng" target="_blank"><li class="github"></li></a>
        </ul>
    </div>
</div>

</body>
<!--   Core JS Files   -->
<script src="//cdn.bootcss.com/jquery/2.1.0/jquery.min.js"></script>
<script src="//cdn.bootcss.com/mixitup/2.1.11/jquery.mixitup.min.js"></script>
<script src="/assets/js/main.js"></script>

</html>
