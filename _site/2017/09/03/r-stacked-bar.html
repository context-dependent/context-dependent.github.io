<!DOCTYPE html>
<html>
    <!DOCTYPE html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="apple-touch-icon" sizes="76x76" href="/assets/images/logo.png">
    <link rel="icon" type="image/png" href="/assets/images/pos_points.png">

    <title>STACKED BARS</title>

    <meta name="keywords" content="thomas mcmanus, context-dependent, R">
    <meta name="author" content="context-dependent">
    <meta name="description" content="This is a bad blog. Don't read thi blog
">

    <meta property="og:site_name" content="context-dependent">
    <meta property="og:url" content="/">
    <meta property="og:title" content="STACKED BARS">
    <meta property="og:type" content="article">
    <meta property="og:description" content="Import Packages">

    <!--   Core CSS Files   -->
    <link href="//cdn.bootcss.com/flex-layout-attribute/1.0.3/css/flex-layout-attribute.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css">

    <!-- Canonical SEO -->
    <link rel="canonical" href="http://localhost:4000/2017/09/03/r-stacked-bar.html">
    <link rel="alternate" type="application/rss+xml" title="context dependent" href="http://localhost:4000/feed.xml">
</head>

<body>
    <div id="nav" layout="row top-left">
    <div self="left">
        <a href="/"><div class="logo logo-isNotVisIfMobile">context dependent</div></a>
        <a href="/"><div class="logo logo-isVisIfMobile"></div></a>
    </div>
    <div class="nav-isNotVisIfMobile">
        <div class="item">
            <a href="/tags">Tags</a>
        </div>
        <div class="item">
            <a href="/videos">Videos</a>
        </div>
    </div>
    <div class="nav-isVisIfMobile">
        <div class="item">
            <a href="/tags">Tags</a>
        </div>
        <div class="item">
            <a href="/videos">Videos</a>
        </div>
    </div>
</div>

    <div id="content">
        <div class="container container--header">
    <h1 class="h1--home-title">STACKED BARS</h1>
    <p>Use dplyr, tidyr, and ggplot2 to quickly make a stacked and facetted bar chart</p>
</div>

        <link rel="stylesheet" type="text/css" href="/assets/css/article.css">

<div class="page-wrapper">
    <div class="container--text">
        <h2 id="import-packages">Import Packages</h2>

<p>Install these packages if you don’t have them already</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggthemes</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h2 id="make-fake-game-data">Make fake game data</h2>

<p>This is a streamlined version of the structure we talked about.
You won’t need to use this chunk for plotting your game data, it’s just
for example purposes, though this is a nice way to make small tables within
a script.</p>
<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">stats</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tribble</span><span class="p">(</span><span class="w">
    </span><span class="o">~</span><span class="n">player</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="n">game</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="n">assists</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="n">goals</span><span class="p">,</span><span class="w">
   </span><span class="s2">"Ondrej"</span><span class="p">,</span><span class="w">     </span><span class="m">1</span><span class="p">,</span><span class="w">        </span><span class="m">2</span><span class="p">,</span><span class="w">      </span><span class="m">1</span><span class="p">,</span><span class="w">
   </span><span class="s2">"Ondrej"</span><span class="p">,</span><span class="w">     </span><span class="m">2</span><span class="p">,</span><span class="w">        </span><span class="m">0</span><span class="p">,</span><span class="w">      </span><span class="m">2</span><span class="p">,</span><span class="w">
   </span><span class="s2">"Ondrej"</span><span class="p">,</span><span class="w">     </span><span class="m">3</span><span class="p">,</span><span class="w">        </span><span class="m">4</span><span class="p">,</span><span class="w">      </span><span class="m">0</span><span class="p">,</span><span class="w">
  </span><span class="s2">"Mateosh"</span><span class="p">,</span><span class="w">     </span><span class="m">1</span><span class="p">,</span><span class="w">        </span><span class="m">2</span><span class="p">,</span><span class="w">      </span><span class="m">2</span><span class="p">,</span><span class="w">
  </span><span class="s2">"Mateosh"</span><span class="p">,</span><span class="w">     </span><span class="m">2</span><span class="p">,</span><span class="w">        </span><span class="m">6</span><span class="p">,</span><span class="w">      </span><span class="m">1</span><span class="p">,</span><span class="w">
  </span><span class="s2">"Mateosh"</span><span class="p">,</span><span class="w">     </span><span class="m">3</span><span class="p">,</span><span class="w">        </span><span class="m">1</span><span class="p">,</span><span class="w">      </span><span class="m">2</span><span class="p">,</span><span class="w">
   </span><span class="s2">"Daniel"</span><span class="p">,</span><span class="w">     </span><span class="m">1</span><span class="p">,</span><span class="w">        </span><span class="m">2</span><span class="p">,</span><span class="w">      </span><span class="m">0</span><span class="p">,</span><span class="w">
   </span><span class="s2">"Daniel"</span><span class="p">,</span><span class="w">     </span><span class="m">2</span><span class="p">,</span><span class="w">        </span><span class="m">0</span><span class="p">,</span><span class="w">      </span><span class="m">1</span><span class="p">,</span><span class="w">
   </span><span class="s2">"Daniel"</span><span class="p">,</span><span class="w">     </span><span class="m">3</span><span class="p">,</span><span class="w">        </span><span class="m">0</span><span class="p">,</span><span class="w">      </span><span class="m">0</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="n">stats</span><span class="w">
</span></code></pre>
</div>

<h2 id="reshape-the-points-and-assists-columns">Reshape the points and assists columns</h2>

<p>the <code class="highlighter-rouge">gather</code> function takes multiple columns and turns them into a key
column, which uses the input column names as values, an a value
column, which uses the input column values as values. In this case,
I’m naming the key column <code class="highlighter-rouge">point_source</code>, and the value column <code class="highlighter-rouge">points</code>.
After reshaping, we’re left with a row for each player, game, and point_source.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">stats_long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">stats</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">gather</span><span class="p">(</span><span class="n">point_source</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">,</span><span class="w"> </span><span class="n">assists</span><span class="o">:</span><span class="n">goals</span><span class="p">)</span><span class="w">

</span><span class="n">stats_long</span><span class="w">
</span></code></pre>
</div>

<h2 id="plot-results-for-each-player">Plot results for each player</h2>

<p>These columns make sense if you think about the way that ggplot works.
ggplot wants exactly one decision per one column of input data. We want
a bar plot for each player, with a bar that represents the number of points
that they scored in a game, coloured by the point source. n this instance,
we are asking ggplot to make 4 decisions: X-axis values (game), Y-axis values
(points), bar fill colour (point_source), and plot facets (player).</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">stats_long</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">game</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">point_source</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">player</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="c1"># The following two lines change the look of the plot
</span><span class="w">  </span><span class="c1"># there are other scales and themes to choose from, these
</span><span class="w">  </span><span class="c1"># are just two that I like
</span><span class="w">    </span><span class="n">scale_fill_wsj</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme_hc</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://localhost:4000/assets/images/stacked_bar.png" alt="points per player per game" /></p>

    </div>
</div>

<style type="text/css">
    .ds-thread {
        max-width: 680px;
        margin: auto;
    }
</style>

<!-- 多说评论框 start -->
<!-- <div class="ds-thread" data-thread-key="/2017/09/03/r-stacked-bar.html" data-title=STACKED BARS data-url=http://localhost:4000/2017/09/03/r-stacked-bar.html></div> -->
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
// var duoshuoQuery = {short_name:"wnglmng"};
//     (function() {
//         var ds = document.createElement('script');
//         ds.type = 'text/javascript';ds.async = true;
//         ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
//         ds.charset = 'UTF-8';
//         (document.getElementsByTagName('head')[0]
//          || document.getElementsByTagName('body')[0]).appendChild(ds);
//     })();
</script>
<!-- 多说公共JS代码 end -->

<div class="related_posts-container" style="max-width: 790px;">
    <p class="related_posts-header">RELATED ARTICLES</p>

    <div layout="rows center-spread">

        
        
        
        
            <a href="/2017/09/01/nfl-stats-1.html">
                <div class="card card--article not-visible" >
                    <div class="card-body">
                        <div class="card-title">HTML TABLES</div>
                        <div class="card-description card-description--clamp-0">
                            This is the first in a series of articles that will use historical data from NFL seasons between 1992 and 2016 to illustrate some data munging, analysis, and visualization techniques in R. Pro-Foot...
                        </div>
                    </div>
                    <div class="card-hero">
                        <div class="card-image card-image--size-185" data-url="https://context-dependent.github.io/assets/images/age_points.png"></div>
                    </div>
                    <div class="card-footer">
                        <div class="card-footer-wrapper" layout="row bottom-left">
                            <div class="card-type is-notShownIfHover">2017-09-01</div>
                            <div class="card-tag is-notShownIfHover">@</div>
                            <div class="card-tag is-shownIfHover">
                                
                                    code &nbsp;&nbsp;
                                
                                    R &nbsp;&nbsp;
                                
                                    ggplot2 &nbsp;&nbsp;
                                
                                    tidyverse &nbsp;&nbsp;
                                
                                    rvest &nbsp;&nbsp;
                                
                            </div>
                            <div class="card-logo is-shownIfHover" self="right"></div>
                        </div>
                    </div>
                 </div>
            </a>
        
        

        

    </div>
</div>


    </div>
    <div id="footer" layout="rows center-left">
    <div id="end-mark">
        <div class="end-mark-icon"></div>
        <p class="copyright">context-dependent © 2017</p>
    </div>
    <div id="footer-links" self="right">
        <ul>
            <a href="#"><li class="wechat" target="_blank"></li></a>
            <a href="mailto:" target="_blank"><li class="mail"></li></a>
            <a href="http://weibo.com/" target="_blank"><li class="weibo"></li></a>
            <a href="https://github.com/" target="_blank"><li class="github"></li></a>
        </ul>
    </div>
</div>

</body>
<!--   Core JS Files   -->
<script src="//cdn.bootcss.com/jquery/2.1.0/jquery.min.js"></script>
<script src="//cdn.bootcss.com/mixitup/2.1.11/jquery.mixitup.min.js"></script>
<script src="/assets/js/main.js"></script>

</html>
